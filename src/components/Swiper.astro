---
// Copyright (c) Pascal Brand
// MIT License

import 'swiper/css/bundle'

import type { AstroSwiperType } from '../index'

type Props = AstroSwiperType


const {
  options={},
  class: className = '',
  uniqueClass = 'astro-swiper-' + Math.random().toString(36).slice(2, 11),
  thumbOf = '',
  ...props
} = Astro.props;

---

<!-- Slider main container -->
<astro-swiper
  class={`swiper ${uniqueClass} ${className}`}
  {...props}
  data-options={JSON.stringify(options)}
  data-thumbof={thumbOf}
  data-uniqueclass={uniqueClass}
  >
    <slot/>
</astro-swiper>


<script>
  import Swiper from 'swiper/bundle'
  import { useSwiper, useOptions } from '../index'

  class AstroSwiper extends HTMLElement {
    constructor() {
      super();

      // Read the message from the data attribute.
      const options = JSON.parse(this.dataset.options || '{}')
      const uniqueClass = this.dataset.uniqueclass || ''   // to have more than 1 swiper in a single page
      const thumbOf = this.dataset.thumbof || ''
      // if (thumbOf !== '') {
      //   options.thumbs = { swiper: useSwiper[thumbOf], ...options.thumbs }
      //   console.log(options.thumbs)
      //   console.log('Thumb is set to ')
      //   console.log(useSwiper[thumbOf])
      // }

      if (thumbOf === '') {
        const swiper = new Swiper(`.${uniqueClass}`, options)
        useSwiper[uniqueClass] = swiper
      }
      useOptions[uniqueClass] = options
    }
  }

  customElements.define('astro-swiper', AstroSwiper);
</script>
